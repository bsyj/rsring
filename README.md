# RS Rings and Tanks Mod

## 项目简介

RS Rings and Tanks 是一个功能强大的 Minecraft 1.12.2 模组（1.3版本），提供物品吸收戒指和经验管理系统。该模组旨在帮助玩家更高效地管理游戏中的物品和经验，提升游戏体验。

### 核心功能

1. **物品吸收戒指** - 自动吸收周围掉落物到绑定的箱子
2. **经验储罐系统** - 存储和管理玩家经验
3. **经验泵控制器** - 统一管理所有经验储罐
4. **Baubles集成** - 完整支持饰品栏

## 安装说明

### 必需依赖
- Minecraft 1.12.2
- Forge 14.23.5.2847 或更高版本

### 推荐依赖
- Baubles 1.5.2 或更高版本（用于饰品栏支持）
- JEI 4.16.1.1013 或更高版本（用于配方显示）

### 安装步骤
1. 安装 Forge 14.23.5.2847 或更高版本
2. 下载并安装 Baubles 模组（可选但推荐）
3. 下载并安装 RS Rings and Tanks 模组
4. 启动游戏，享受模组带来的便利

## 使用方法

### 物品吸收戒指

1. **制作戒指**
   - 使用工作台合成（具体配方需在游戏中查看）

2. **绑定箱子**
   - 手持戒指
   - 蹲下（Shift）+ 右键点击箱子
   - 聊天显示"已绑定坐标"消息
   - **注意**：当前版本暂不支持绑定RS终端，仅支持绑定普通箱子

3. **配置过滤**
   - 右键打开GUI
   - 将物品放入9个过滤槽
   - 点击按钮切换黑白名单模式

4. **开启功能**
   - 按K键切换开关
   - 戒指可放在背包、手持或饰品栏

5. **充能**
   - 使用任何FE充能器充电
   - 最大容量：10M FE

### 经验储罐系统

1. **制作储罐**
   - 使用工作台合成（具体配方需在游戏中查看）

2. **使用控制器**
   - 手持控制器，右键打开GUI
   - 控制器会自动检测所有储罐

3. **存入经验**
   - 点击"存入1级"或"存入全部"
   - 玩家经验转移到储罐

4. **取出经验**
   - 点击"取出1级"或"取出全部"
   - 储罐经验转移到玩家

5. **配置模式**
   - 点击"模式"按钮切换
   - 设置保留等级
   - 开启/关闭修补模式

6. **升级储罐**
   - 使用储罐 + 钻石在工作台合成
   - 容量翻倍（1000 → 2000 → 4000...）
   - 经验不会丢失

### 经验泵控制器

1. **制作控制器**
   - 使用工作台合成（具体配方需在游戏中查看）

2. **打开界面**
   - 右键点击控制器打开GUI

3. **配置选项**
   - **模式**：关闭、从玩家泵入、向玩家泵出
   - **保留等级**：设置玩家保留的经验等级
   - **修补**：开启/关闭自动修补装备功能

4. **使用方法**
   - 将控制器放在背包中即可自动管理所有储罐
   - 切换控制器会应用不同的配置

## 技术细节

### 物品吸收戒指技术实现

- **能量系统**：使用FE能量，最大容量10M FE
- **物品过滤**：黑白名单系统，支持9个过滤槽
- **跨维度传送**：支持在不同维度间传送物品
- **Baubles集成**：完整支持在饰品栏中使用
- **自动吸收**：每5tick自动吸收8格内的掉落物
- **绑定系统**：使用Forge能力系统存储绑定信息

### 经验储罐技术实现

- **经验存储**：使用指数增长公式计算容量（1000 * 2^(level-1)）
- **经验抽取**：自动抽取周围经验球和经验瓶
- **经验泵送**：三种工作模式，可自动补充或抽取玩家经验
- **保留等级**：可设置玩家保留的经验等级
- **修补模式**：使用经验自动修复装备
- **升级系统**：可升级储罐容量，经验不会丢失
- **动态纹理**：根据填充百分比变化显示不同纹理

### 经验泵控制器技术实现

- **统一管理**：自动检测背包、手持、饰品栏中的储罐
- **配置存储**：配置存储在控制器物品上
- **批量操作**：可同时操作多个储罐
- **实时同步**：使用网络数据包同步储罐状态

### 核心技术架构

1. **能力系统**：使用Forge Capability系统存储和管理数据
   - `IRsRingCapability`：戒指能力接口
   - `IExperiencePumpCapability`：经验泵能力接口

2. **网络系统**：使用SimpleNetworkWrapper实现客户端-服务端通信
   - `PacketToggleRsRing`：切换戒指功能
   - `PacketPumpAction`：执行泵送操作
   - `PacketSyncRingFilter`：同步戒指过滤器
   - `PacketSyncTankSlots`：同步储罐槽位

3. **事件系统**：使用Forge事件总线处理游戏事件
   - `CommonEventHandler`：处理通用事件
   - `CraftingUpgradeHandler`：处理升级合成
   - `InventoryChangeHandler`：处理物品栏变化

4. **经验计算**：使用Minecraft官方经验公式
   - 0-15级：`level * (6 + level)`
   - 16-30级：`level * (2.5 * level - 40.5) + 360`
   - 31+级：`level * (4.5 * level - 162.5) + 2220`

## 配置选项

### 戒指配置

配置文件位置：`.minecraft/config/rsring/ring_config.cfg`

可以通过模组列表中的"Config"按钮直接访问配置界面，也可以手动编辑配置文件。

```properties
# 默认黑名单物品（使用物品注册名）
defaultBlacklistItems=[]

# 默认白名单物品
defaultWhitelistItems=[]

# 默认使用黑名单模式
useBlacklistModeByDefault=true

# 吸收范围（格）
absorptionRange=8

# 每个物品能量消耗（FE）
energyCostPerItem=1

# 最大能量容量（FE）
maxEnergyCapacity=10000000

# 允许自定义过滤
allowCustomFilters=true

# 吸收间隔（tick）
absorptionInterval=5

# 初始能量（FE）
initialEnergy=0

# 能量消耗倍率
energyCostMultiplier=1.0
```

### 经验储罐配置

配置文件位置：`.minecraft/config/rsring/experience_tank_config.cfg`

同样可以通过模组列表中的"Config"按钮访问配置界面。

```properties
# 启用经验储罐系统
enabled=true

# 经验抽取速率（每次最多抽取的经验值）
xpExtractionRate=10

# 经验抽取范围（格）
xpExtractionRange=8.0

# 经验抽取间隔（刻）
extractionInterval=20

# 修补间隔（刻）
mendingInterval=40

# 启用自动泵送
enableAutoPumping=true

# 启用经验瓶溢出
enableOverflowBottles=true

# 从经验瓶物品中抽取经验
extractXpBottles=true

# 修补玩家物品
mendPlayerItems=true
```

### 配置界面访问

1. 启动游戏并进入主菜单
2. 点击"Mods"按钮
3. 在模组列表中找到"RS Rings and Tanks"模组
4. 点击右侧的"Config"按钮
5. 即可看到所有配置选项，可以直接在界面中修改并保存

## 常见问题

### Q: K键没有反应？
**A**: 检查是否有其他模组占用了K键，可以在设置中重新绑定。

### Q: 控制器显示"无储罐"？
**A**: 确保储罐在背包、手持或饰品栏中，控制器会自动检测。

### Q: 经验储罐升级后经验丢失？
**A**: 这个问题已在1.1版本修复，升级时经验会被保留。

### Q: 戒指在饰品栏无法使用K键？
**A**: 这个问题已在1.1版本修复，确保安装了Baubles模组。

### Q: 如何配置默认黑白名单？
**A**: 编辑配置文件 `.minecraft/config/rsring/ring_config.cfg`，添加物品注册名。

### Q: 经验储罐已满时会发生什么？
**A**: 当经验储罐已满时，会停止吸收经验。如果启用了溢出功能，多余的经验会转化为经验瓶掉落。

### Q: 物品吸收戒指的能量消耗如何计算？
**A**: 每tick消耗1FE维持运行，每次传输物品消耗1FE。

## 合成配方

### 物品吸收戒指
- 钻石 * 4
- 末影珍珠 * 1
- 下界之星 * 1
- 红石 * 2

### 经验储罐
- 钻石 * 3
- 末影珍珠 * 2
- 经验瓶 * 3

### 经验泵控制器
- 钻石 * 2
- 末影珍珠 * 1
- 红石 * 3
- 金锭 * 2

## 致谢

- **Azanor** - Baubles 模组作者，提供了饰品栏API
- **Lothrazar** - Cyclic 模组作者，提供了GUI纹理和布局参考
- **SophisticatedBackpacks** - 提供了XP计算逻辑参考
- **Minecraft Forge 团队** - 提供了模组开发框架

## 许可证

本项目使用MIT许可证。

## 未来计划

### 功能计划
- **实现RS终端绑定功能** - 让物品吸收戒指可以绑定到RS终端
- **增加更多饰品栏装备** - 扩展饰品系统，添加更多有用的饰品
- **优化经验系统性能** - 进一步提升经验抽取和存储的效率
- **添加更多配置选项** - 让用户可以更灵活地自定义模组功能
- **增加新的经验相关物品** - 扩展经验系统的玩法

## 版本历史

### 1.3
- 统一了配置系统，使用Forge的@Config注解系统
- 优化了配置界面，自动生成配置选项和分类
- 修复了配置相关的问题，提升了模组的稳定性
- 更新了版本号和相关文档
- 改进了配置系统的可维护性和可扩展性

### 1.2
- 新增了100级、500级、1000级经验储罐
- 优化了经验储罐的填充等级判断逻辑
- 改进了物品吸收戒指的GUI访问方式
- 修复了跨维度物品传送的稳定性问题
- 优化了经验抽取和存储的性能
- 更新了模组依赖和兼容性

### 1.1
- 修复了经验储罐升级后经验丢失的问题
- 修复了戒指绑定消息发送两次的问题
- 优化了经验抽取逻辑，提高了效率
- 改进了Baubles集成，确保戒指在饰品栏中正常工作
- 增加了经验储罐的动态纹理显示

### 1.0
- 初始版本
- 实现了物品吸收戒指功能
- 实现了经验储罐系统
- 实现了经验泵控制器
- 添加了Baubles集成

## 开发说明

### 构建项目

1. 克隆仓库到本地
2. 运行 `gradlew setupDecompWorkspace` 搭建开发环境
3. 运行 `gradlew eclipse` 生成Eclipse项目（或 `gradlew genIntellijRuns` 生成IntelliJ项目）
4. 运行 `gradlew build` 构建项目
5. 构建后的文件在 `build/libs` 目录中

### 代码结构

```
src/
├── main/
│   ├── java/
│   │   └── com/moremod/
│   │       ├── capability/       # 能力系统实现
│   │       ├── client/           # 客户端相关代码
│   │       ├── config/           # 配置文件处理
│   │       ├── event/            # 事件处理器
│   │       ├── experience/       # 经验系统相关代码
│   │       ├── item/             # 物品实现
│   │       ├── network/          # 网络数据包
│   │       ├── proxy/            # 代理类
│   │       ├── rsring/           # 主模组类
│   │       ├── service/          # 服务类
│   │       └── util/             # 工具类
│   └── resources/                # 资源文件
│       ├── assets/               # 游戏资源
│       │   └── rsring/           # 模组资源
│       │       ├── gui/          # GUI纹理
│       │       ├── lang/         # 语言文件
│       │       ├── models/       # 模型文件
│       │       ├── recipes/      # 合成配方
│       │       └── textures/     # 纹理文件
│       └── mcmod.info            # 模组信息
```

## 问题反馈

如果发现问题，请提供以下信息：

1. **问题描述** - 详细说明问题
2. **复现步骤** - 如何触发问题
3. **日志文件** - `logs/latest.log`
4. **截图/录屏** - 如果可能
5. **模组列表** - 其他安装的模组

## 贡献指南

欢迎贡献代码、报告问题或提出建议！请按照以下步骤：

1. Fork 仓库
2. 创建新分支
3. 提交更改
4. 创建Pull Request

## 联系方式

- 项目地址：https://github.com/bsyj/rsring
- 问题追踪：https://github.com/bsyj/rsring/issues

---

**享受游戏！** 🎮